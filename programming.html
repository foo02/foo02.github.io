<!DOCTYPE html>
<html><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Windowsプログラミング</title>
<link rel="stylesheet" href="https://foo02.github.io/normalize.css" />
<link rel="stylesheet" href="https://foo02.github.io/style.css" />
<link rel="icon" href="/favicon.png" />
</head><body><header>
<div id="date"></div>
<div><a href="https://foo02.github.io/">トップページ</a></div>
<h1>Windowsプログラミング</h1>
<nav id="TableOfContents">
  <ul>
    <li><a href="#はじめに">はじめに</a></li>
    <li><a href="#プログラミングの予備知識">プログラミングの予備知識</a>
      <ul>
        <li><a href="#ポインタ">ポインタ</a></li>
        <li><a href="#クラスおよびオブジェクト">クラスおよびオブジェクト</a></li>
      </ul>
    </li>
    <li><a href="#アプリケーションの開発環境">アプリケーションの開発環境</a></li>
    <li><a href="#プログラミングの作業工程">プログラミングの作業工程</a>
      <ul>
        <li><a href="#hello-world">Hello World</a></li>
        <li><a href="#メッセージボックスの表示">メッセージボックスの表示</a></li>
        <li><a href="#メインウィンドウの表示その1">メインウィンドウの表示(その1)</a></li>
        <li><a href="#メインウィンドウの表示その2">メインウィンドウの表示(その2)</a></li>
        <li><a href="#ソースファイルの分割">ソースファイルの分割</a></li>
        <li><a href="#ビルド作業の自動化">ビルド作業の自動化</a></li>
        <li><a href="#メインウィンドウの表示その3">メインウィンドウの表示(その3)</a></li>
      </ul>
    </li>
    <li><a href="#プログラミングの学習方法">プログラミングの学習方法</a></li>
  </ul>
</nav>
</header><div id="content">
<h2 id="はじめに">はじめに</h2>
<p>MSYS2という開発環境を使用してWindowsアプリケーションを作成する方法を紹介します。MSYS2については<a href="/unix.html">Unixの基本操作</a>を参照してください。</p>
<h2 id="プログラミングの予備知識">プログラミングの予備知識</h2>
<p>以下に掲載するコードは<a href="https://ja.wikipedia.org/wiki/C%E8%A8%80%E8%AA%9E">C言語</a>および<a href="https://ja.wikipedia.org/wiki/C%2B%2B">C++</a>というプログラミング言語で記述されています。C言語で記述されたコードの中ではWindowsの機能にアクセスするために<a href="https://ja.wikipedia.org/wiki/Windows_API">WindowsAPI</a>を使用しています。<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>WindowsAPIを使用するためのツールがWindowsSDKです。C言語とWindowsSDKの組み合わせを「CとSDK」といったりします。</p>
<p>C++はC言語を拡張してオブジェクト指向でプログラミングできるようにした言語です。C++はC言語との互換性を持たせて拡張したので他の純粋なオブジェクト指向の言語と比べて仕様が複雑になっていますがC言語にはない便利な機能がたくさん追加されています。詳細については<a href="https://rinatz.github.io/cpp-book/">ゼロから学ぶC++</a>/<a href="https://programming-place.net/ppp/index.html">Programming Place Plus</a>/<a href="http://stlalv.la.coocan.jp/">C++マニアック</a>などを参照してください。</p>
<p>アプリケーションを作成するにはプログラムのソースコードを編集するためのテキストエディタをはじめ、ソースファイルからオブジェクトファイルを生成するためのコンパイラやオブジェクトファイルとライブラリをリンクするためのリンカなどが必要です。アプリケーションを作成するためのこれらのプログラムを総称して<a href="https://ja.wikipedia.org/wiki/%E3%83%84%E3%83%BC%E3%83%AB%E3%83%81%E3%82%A7%E3%83%BC%E3%83%B3">ツールチェーン</a>といいます。</p>
<p><a href="https://ja.wikipedia.org/wiki/%E3%82%B0%E3%83%A9%E3%83%95%E3%82%A3%E3%82%AB%E3%83%AB%E3%83%A6%E3%83%BC%E3%82%B6%E3%82%A4%E3%83%B3%E3%82%BF%E3%83%95%E3%82%A7%E3%83%BC%E3%82%B9">GUI</a>のアプリケーションを作成するには<a href="https://ja.wikipedia.org/wiki/%E3%82%A6%E3%82%A3%E3%82%B8%E3%82%A7%E3%83%83%E3%83%88%E3%83%BB%E3%83%84%E3%83%BC%E3%83%AB%E3%82%AD%E3%83%83%E3%83%88">GUIツールキット</a>と<a href="https://ja.wikipedia.org/wiki/GUI%E3%83%93%E3%83%AB%E3%83%80">GUIビルダ</a>を使用します。WindowsAPIはWindowsに内蔵されている低レベルなツールキットです。<a href="https://ja.wikipedia.org/wiki/Windows_Template_Library">WTL</a>や<a href="https://ja.wikipedia.org/wiki/WxWidgets">wxWidgets</a>などの高レベルなツールキットを使用することもできます。詳細については<a href="http://wisdom.sakura.ne.jp/">WisdomSoft</a>や<a href="https://vivacocoa.jp/">viva Cocoa</a>を参照してください。</p>
<h3 id="ポインタ">ポインタ</h3>
<p>C言語のポインタについてかみ砕いて説明します。変数のデータはコンピュータのメモリのどこかに置かれています。その置かれている場所をアドレスといいます。アドレスは変数の住所のようなものだと考えてください。変数は変数名だけでなくアドレスによっても表現することができます。ポインタは変数のアドレスを格納するための変数です。ポインタと聞くと何か特別なもののように感じますがただの変数に過ぎません。ポインタ変数もしくはアドレス型の変数といったほうが分かりやすいかもしれません。</p>
<p>ポインタの値すなわち変数のアドレスを変更するためにポインタのポインタが使用されることがあります。ポインタのポインタと聞くと頭が混乱するかもしれませんが難しいことではありません。以下のコードを見てよく考えてください。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C++" data-lang="C++"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">void</span>) {
  <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>ptr;      <span style="color:#75715e">// ポインタ
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>ptrptr;  <span style="color:#75715e">// ポインタのポインタ
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">char</span> str1[<span style="color:#ae81ff">256</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;foo&#34;</span>;
  <span style="color:#66d9ef">char</span> str2[<span style="color:#ae81ff">256</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bar&#34;</span>;
  ptr <span style="color:#f92672">=</span> str1;           <span style="color:#75715e">// ptrにstr1のアドレスを代入
</span><span style="color:#75715e"></span>  printf(<span style="color:#e6db74">&#34;%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, ptr);  <span style="color:#75715e">// fooと表示
</span><span style="color:#75715e"></span>  ptrptr <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>ptr;        <span style="color:#75715e">// ptrのアドレスをptrptrに代入
</span><span style="color:#75715e"></span>  <span style="color:#f92672">*</span>ptrptr <span style="color:#f92672">=</span> str2;  <span style="color:#75715e">// ptrptrを参照してptrにstr2のアドレスを代入
</span><span style="color:#75715e"></span>  printf(<span style="color:#e6db74">&#34;%s</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, ptr);  <span style="color:#75715e">// barと表示
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}</code></pre></div></div>
</figure>
<p>ポインタにconstを適用する場合、ポインタの示すアドレスを定数にするのかそれともそのアドレスに置かれているデータを定数にするのかという問題が生じます。これは次のように書き分けます。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C++" data-lang="C++"><span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> <span style="color:#66d9ef">const</span> p; <span style="color:#75715e">// アドレスが定数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> p; <span style="color:#75715e">// データが定数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#66d9ef">const</span><span style="color:#f92672">*</span> p; <span style="color:#75715e">// データが定数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span><span style="color:#f92672">*</span> <span style="color:#66d9ef">const</span> p; <span style="color:#75715e">// アドレス・データともに定数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> <span style="color:#66d9ef">const</span><span style="color:#f92672">*</span> <span style="color:#66d9ef">const</span> p; <span style="color:#75715e">// アドレス・データともに定数
</span></code></pre></div></div>
</figure>
<h3 id="クラスおよびオブジェクト">クラスおよびオブジェクト</h3>
<p>C++のクラスについて簡単に説明します。C言語の構造体はそのメンバとして型の異なる複数の変数を持つことができます。クラスはメンバとして関数を持てるように構造体を拡張したものです。クラスのメンバ変数を<em>プロパティ</em>、クラスのメンバ関数を<em>メソッド</em>、クラス型の変数を<em>オブジェクト</em>、クラスを変数として実体化することを<em>インスタンス化</em>といいます。</p>
<p>オブジェクトはデータに機能を持たせたものと捉えることができます。オブジェクトのプロパティはメソッドを介して参照・操作します。プロパティを直接参照したり操作したりすることは一般的ではありません。このようにインターフェイスのみを公開して実装を非公開にすることを<em>カプセル化</em>といいます。カプセル化することによってプログラムの保守性・拡張性・移植性を高めることができます。</p>
<p>C++のクラスのメンバにはprivate/public/protectedという3つの属性があります。privateメンバは自クラスからしか参照することができず外部からは参照することができません。publicメンバは自クラスだけでなく外部からも参照することができます。protectedメンバはprivateメンバと同様に外部からは参照することができませんが自クラスだけでなく派生クラスからも参照することができます。派生クラス(サブクラス)とは文字通りあるクラスから派生したクラスです。派生元のクラスを基底クラス(ベースクラス)といい派生クラスは基底クラスのメンバを継承します。メソッドにvertualというキーワードをつけるとそのメソッドを派生クラスで再定義(オーバーライド)することができます。またC++では引数の型や数の異なる同名の関数を定義(オーバーロード)することができます。オーバーライド(メソッドの再定義)とオーバーロード(関数の多重定義)を混同しないように注意してください。</p>
<p>C言語は文字列を扱うのが苦手ですがC++にはstringというクラスが用意されているので文字列を簡単に処理することができます。データ構造やアルゴリズムを扱うクラスライブラリとして<a href="https://ja.wikipedia.org/wiki/Standard_Template_Library">STL</a>も用意されています。</p>
<h2 id="アプリケーションの開発環境">アプリケーションの開発環境</h2>
<p>実際にアプリケーションを作成する前にアプリケーションの開発環境を構築する必要があります。ここでは開発環境としてMSYS2を使用します。MSYS2にツールチェーンとして<a href="https://ja.wikipedia.org/wiki/MinGW">MinGW</a>をインストールします。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># pacman -S mingw-w64-i686-toolchain
# pacman -S mingw-w64-x86_64-toolchain</code></pre></div></div>
</figure>
<p>mingw-w64-*-toolchainはMinGWのパッケージグループです。32bit(i686)および64bit(x86_64)の環境で動作するアプリケーションを作成するためのツールチェーンを個別にインストールします。MinGWを使用するにはスタートメニューから<strong>MSYS2 MinGW 32-bit</strong>もしくは<strong>MSYS2 MinGW
64-bit</strong>のいずれかを選択します。<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></p>
<p>MinGWにはテキストエディタが含まれていないので別途用意します。MSYS2には<a href="https://ja.wikipedia.org/wiki/Geany">Geany</a>/<a href="https://ja.wikipedia.org/wiki/Gedit">gedit</a>/<a href="https://ja.wikipedia.org/wiki/Kate">Kate</a>/<a href="https://ja.wikipedia.org/wiki/Vim">Vim</a>などのテキストエディタが用意されています。文字コードとしてUnicodeが扱えるものであればWindows用のテキストエディタでも構いません。<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></p>
<!-- リソースエディタには[ResEdit](http://www.resedit.net/)などを使用します。 -->
<h2 id="プログラミングの作業工程">プログラミングの作業工程</h2>
<h3 id="hello-world">Hello World</h3>
<p>細かい理屈は後回しにして実際に簡単なプログラムを作って動かしてみましょう。文字化けを防ぐためテキストエディタでソースコードを保存する際は文字コードとしてUTF-8を指定してください。</p>
<p>以下のコードを記述したソースファイルhello.cを作成します。</p>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">hello.c</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C++" data-lang="C++"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">void</span>) {
  printf(<span style="color:#e6db74">&#34;hello, world!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}</code></pre></div></div>
</figure>
<p>コマンドgccを入力してhello.cをコンパイルし出力されたa.exeを実行します。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># gcc hello.c
# ./a.exe</code></pre></div></div>
</figure>
<p>hello, world!と表示されたら成功です。</p>
<h3 id="メッセージボックスの表示">メッセージボックスの表示</h3>
<p>メッセージボックスを表示してみます。以下のコードを記述したソースファイルmessage.cを作成します。</p>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">message.c</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C++" data-lang="C++"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;windows.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> WINAPI <span style="color:#a6e22e">WinMain</span>(HINSTANCE hInst, HINSTANCE hPrevInst, LPSTR pCmdLine,
                   <span style="color:#66d9ef">int</span> showCmd) {
  MessageBox(NULL, <span style="color:#e6db74">&#34;やあ、こんにちは&#34;</span>, <span style="color:#e6db74">&#34;メッセージ&#34;</span>, MB_OK);
  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}</code></pre></div></div>
</figure>
<p>コマンドgccを入力してmessage.cをコンパイルします。今回はオプション-oで出力する実行ファイルを指定しています。-fexec-charset=CP932は文字化けを防ぐためのオプションです。WindowsアプリケーションではテキストデータをUnicode(UTF-8)ではなくShift-JIS(CP932)として処理しています。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># gcc message.c -o message.exe -fexec-charset=CP932
# ./message.exe</code></pre></div></div>
</figure>
<p>メッセージボックスが表示されたら成功です。</p>
<h3 id="メインウィンドウの表示その1">メインウィンドウの表示(その1)</h3>
<p>ウィンドウを表示してみます。以下のコードを記述したソースファイルwindow.cを作成します。</p>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">window.c</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C++" data-lang="C++"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;windows.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// 記号定数
</span><span style="color:#75715e"></span><span style="color:#75715e">#define WINDOW_CLASS &#34;foo&#34;                 </span><span style="color:#75715e">// ウィンドウクラス名
</span><span style="color:#75715e"></span><span style="color:#75715e">#define WINDOW_TITLE &#34;サンプルウィンドウ&#34;  </span><span style="color:#75715e">// タイトルバーの文字列
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// プロトタイプ宣言
</span><span style="color:#75715e"></span>LRESULT CALLBACK <span style="color:#a6e22e">WindowProc</span>(HWND hWnd, UINT msg, WPARAM wp, LPARAM lp);

<span style="color:#75715e">// エントリポイント
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> WINAPI <span style="color:#a6e22e">WinMain</span>(HINSTANCE hInst, HINSTANCE hPrevInst, LPSTR lpCmdLine,
                   <span style="color:#66d9ef">int</span> iCmdShow) {
  WNDCLASSEX wc;  <span style="color:#75715e">// ウィンドウクラス構造体
</span><span style="color:#75715e"></span>  HWND hWnd;      <span style="color:#75715e">// ウィンドウハンドル
</span><span style="color:#75715e"></span>  MSG msg;        <span style="color:#75715e">// メッセージ構造体
</span><span style="color:#75715e"></span>
  <span style="color:#75715e">// ウィンドウクラスを設定
</span><span style="color:#75715e"></span>  wc.cbSize <span style="color:#f92672">=</span> <span style="color:#66d9ef">sizeof</span>(wc);              <span style="color:#75715e">// 構造体のサイズ
</span><span style="color:#75715e"></span>  wc.style <span style="color:#f92672">=</span> CS_HREDRAW <span style="color:#f92672">|</span> CS_VREDRAW;  <span style="color:#75715e">// スタイル
</span><span style="color:#75715e"></span>  wc.lpfnWndProc <span style="color:#f92672">=</span> WindowProc;         <span style="color:#75715e">// ウィンドウプロシージャ
</span><span style="color:#75715e"></span>  wc.cbClsExtra <span style="color:#f92672">=</span> wc.cbWndExtra <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;   <span style="color:#75715e">// 拡張領域のサイズ
</span><span style="color:#75715e"></span>  wc.hInstance <span style="color:#f92672">=</span> hInst;                <span style="color:#75715e">// インスタンスハンドル
</span><span style="color:#75715e"></span>  wc.hIcon <span style="color:#f92672">=</span> LoadIcon(NULL, IDI_APPLICATION);  <span style="color:#75715e">// アイコン
</span><span style="color:#75715e"></span>  wc.hIconSm <span style="color:#f92672">=</span> wc.hIcon;                       <span style="color:#75715e">// アイコン(小)
</span><span style="color:#75715e"></span>  wc.hCursor <span style="color:#f92672">=</span> LoadCursor(NULL, IDC_ARROW);    <span style="color:#75715e">// カーソル
</span><span style="color:#75715e"></span>  wc.hbrBackground <span style="color:#f92672">=</span> (HBRUSH)(COLOR_WINDOW);   <span style="color:#75715e">// 背景色
</span><span style="color:#75715e"></span>  wc.lpszMenuName <span style="color:#f92672">=</span> NULL;                      <span style="color:#75715e">// メニュー名
</span><span style="color:#75715e"></span>  wc.lpszClassName <span style="color:#f92672">=</span> WINDOW_CLASS;             <span style="color:#75715e">// ウィンドウクラス名
</span><span style="color:#75715e"></span>
  <span style="color:#75715e">// ウィンドウクラスを登録
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (RegisterClassEx(<span style="color:#f92672">&amp;</span>wc) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
  }

  <span style="color:#75715e">// ウィンドウを作成
</span><span style="color:#75715e"></span>  hWnd <span style="color:#f92672">=</span> CreateWindow(WINDOW_CLASS,         <span style="color:#75715e">// ウィンドウクラス名
</span><span style="color:#75715e"></span>                      WINDOW_TITLE,         <span style="color:#75715e">// タイトルバーの文字列
</span><span style="color:#75715e"></span>                      WS_OVERLAPPEDWINDOW,  <span style="color:#75715e">// スタイル
</span><span style="color:#75715e"></span>                      CW_USEDEFAULT, CW_USEDEFAULT,  <span style="color:#75715e">// 位置
</span><span style="color:#75715e"></span>                      CW_USEDEFAULT, CW_USEDEFAULT,  <span style="color:#75715e">// サイズ
</span><span style="color:#75715e"></span>                      NULL,   <span style="color:#75715e">// 親ウィンドウのハンドル
</span><span style="color:#75715e"></span>                      NULL,   <span style="color:#75715e">// メニューハンドル
</span><span style="color:#75715e"></span>                      hInst,  <span style="color:#75715e">// インスタンスハンドル
</span><span style="color:#75715e"></span>                      NULL    <span style="color:#75715e">// lpに渡す構造体のポインタ
</span><span style="color:#75715e"></span>  );
  <span style="color:#66d9ef">if</span> (hWnd <span style="color:#f92672">==</span> NULL) {
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
  }

  <span style="color:#75715e">// ウィンドウを表示
</span><span style="color:#75715e"></span>  ShowWindow(hWnd, iCmdShow);
  UpdateWindow(hWnd);

  <span style="color:#75715e">// メッセージループ
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">while</span> (TRUE) {
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> GetMessage(<span style="color:#f92672">&amp;</span>msg, NULL, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
    <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> i <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) {
      <span style="color:#66d9ef">break</span>;
    }
    TranslateMessage(<span style="color:#f92672">&amp;</span>msg);
    DispatchMessage(<span style="color:#f92672">&amp;</span>msg);
  }

  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#75715e">// ウィンドウプロシージャ
</span><span style="color:#75715e"></span>LRESULT CALLBACK <span style="color:#a6e22e">WindowProc</span>(HWND hWnd, UINT msg, WPARAM wp, LPARAM lp) {
  <span style="color:#66d9ef">switch</span> (msg) {
    <span style="color:#66d9ef">case</span> WM_DESTROY:
      PostQuitMessage(<span style="color:#ae81ff">0</span>);
      <span style="color:#66d9ef">break</span>;
    <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
      <span style="color:#66d9ef">break</span>;
  }
  <span style="color:#66d9ef">return</span> DefWindowProc(hWnd, msg, wp, lp);
}</code></pre></div></div>
</figure>
<p>コマンドgccを入力してwindow.cをコンパイルします。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># gcc window.c -o window.exe -fexec-charset=CP932
# ./window.exe</code></pre></div></div>
</figure>
<p>ウィンドウが表示されたら成功です。かなり長いコードですがこれが雛形です。処理の流れを簡単に説明します。</p>
<ol>
<li>ウィンドウクラスを元にウィンドウを作成します。<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup></li>
<li>メッセージループを開始します。</li>
<li>イベントが発生するとシステムがメッセージを発行します。</li>
<li>メッセージループがメッセージを受け取りウィンドウプロシージャに送信します。</li>
<li>ウィンドウプロシージャがメッセージを受け取りイベントを処理します。<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup></li>
<li>アプリケーションが終了するまで3～5を繰り返します。</li>
</ol>
<p>イベントの処理を記述することがWindowsプログラミングの主な作業になります。このようなプログラムを<em>イベントドリブン</em>(イベント駆動型)といいます。ウィンドウプロシージャはシステムから自動的に呼び出されるという意味で<em>コールバック関数</em>とも呼ばれます。</p>
<h3 id="メインウィンドウの表示その2">メインウィンドウの表示(その2)</h3>
<p>メニューのついたウィンドウを表示してみます。以下のコードを記述したソースファイルwindow.cを作成します。</p>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">window.c</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C++" data-lang="C++"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;windows.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// 記号定数
</span><span style="color:#75715e"></span><span style="color:#75715e">#define WINDOW_CLASS &#34;foo&#34;                 </span><span style="color:#75715e">// ウィンドウクラス名
</span><span style="color:#75715e"></span><span style="color:#75715e">#define WINDOW_TITLE &#34;サンプルウィンドウ&#34;  </span><span style="color:#75715e">// タイトルバーの文字列
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// プロトタイプ宣言
</span><span style="color:#75715e"></span>LRESULT CALLBACK <span style="color:#a6e22e">WindowProc</span>(HWND hWnd, UINT msg, WPARAM wp, LPARAM lp);

<span style="color:#75715e">// エントリポイント
</span><span style="color:#75715e"></span><span style="color:#66d9ef">int</span> WINAPI <span style="color:#a6e22e">WinMain</span>(HINSTANCE hInst, HINSTANCE hPrevInst, LPSTR lpCmdLine,
                   <span style="color:#66d9ef">int</span> iCmdShow) {
  WNDCLASSEX wc;  <span style="color:#75715e">// ウィンドウクラス構造体
</span><span style="color:#75715e"></span>  HWND hWnd;      <span style="color:#75715e">// ウィンドウハンドル
</span><span style="color:#75715e"></span>  MSG msg;        <span style="color:#75715e">// メッセージ構造体
</span><span style="color:#75715e"></span>
  <span style="color:#75715e">// ウィンドウクラスを設定
</span><span style="color:#75715e"></span>  wc.cbSize <span style="color:#f92672">=</span> <span style="color:#66d9ef">sizeof</span>(wc);              <span style="color:#75715e">// 構造体のサイズ
</span><span style="color:#75715e"></span>  wc.style <span style="color:#f92672">=</span> CS_HREDRAW <span style="color:#f92672">|</span> CS_VREDRAW;  <span style="color:#75715e">// スタイル
</span><span style="color:#75715e"></span>  wc.lpfnWndProc <span style="color:#f92672">=</span> WindowProc;         <span style="color:#75715e">// ウィンドウプロシージャ
</span><span style="color:#75715e"></span>  wc.cbClsExtra <span style="color:#f92672">=</span> wc.cbWndExtra <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;   <span style="color:#75715e">// 拡張領域のサイズ
</span><span style="color:#75715e"></span>  wc.hInstance <span style="color:#f92672">=</span> hInst;                <span style="color:#75715e">// インスタンスハンドル
</span><span style="color:#75715e"></span>  wc.hIcon <span style="color:#f92672">=</span> LoadIcon(NULL, IDI_APPLICATION);  <span style="color:#75715e">// アイコン
</span><span style="color:#75715e"></span>  wc.hIconSm <span style="color:#f92672">=</span> wc.hIcon;                       <span style="color:#75715e">// アイコン(小)
</span><span style="color:#75715e"></span>  wc.hCursor <span style="color:#f92672">=</span> LoadCursor(NULL, IDC_ARROW);    <span style="color:#75715e">// カーソル
</span><span style="color:#75715e"></span>  wc.hbrBackground <span style="color:#f92672">=</span> (HBRUSH)(COLOR_WINDOW);   <span style="color:#75715e">// 背景色
</span><span style="color:#75715e"></span>  wc.lpszMenuName <span style="color:#f92672">=</span> NULL;                      <span style="color:#75715e">// メニュー名
</span><span style="color:#75715e"></span>  wc.lpszClassName <span style="color:#f92672">=</span> WINDOW_CLASS;             <span style="color:#75715e">// ウィンドウクラス名
</span><span style="color:#75715e"></span>
  <span style="color:#75715e">// ウィンドウクラスを登録
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> (RegisterClassEx(<span style="color:#f92672">&amp;</span>wc) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) {
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
  }

  <span style="color:#75715e">// ウィンドウを作成
</span><span style="color:#75715e"></span>  hWnd <span style="color:#f92672">=</span> CreateWindow(WINDOW_CLASS,         <span style="color:#75715e">// ウィンドウクラス名
</span><span style="color:#75715e"></span>                      WINDOW_TITLE,         <span style="color:#75715e">// タイトルバーの文字列
</span><span style="color:#75715e"></span>                      WS_OVERLAPPEDWINDOW,  <span style="color:#75715e">// スタイル
</span><span style="color:#75715e"></span>                      CW_USEDEFAULT, CW_USEDEFAULT,  <span style="color:#75715e">// 位置
</span><span style="color:#75715e"></span>                      CW_USEDEFAULT, CW_USEDEFAULT,  <span style="color:#75715e">// サイズ
</span><span style="color:#75715e"></span>                      NULL,   <span style="color:#75715e">// 親ウィンドウのハンドル
</span><span style="color:#75715e"></span>                      NULL,   <span style="color:#75715e">// メニューハンドル
</span><span style="color:#75715e"></span>                      hInst,  <span style="color:#75715e">// インスタンスハンドル
</span><span style="color:#75715e"></span>                      NULL    <span style="color:#75715e">// lpに渡す構造体のポインタ
</span><span style="color:#75715e"></span>  );
  <span style="color:#66d9ef">if</span> (hWnd <span style="color:#f92672">==</span> NULL) {
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
  }

  <span style="color:#75715e">// ウィンドウを表示
</span><span style="color:#75715e"></span>  ShowWindow(hWnd, iCmdShow);
  UpdateWindow(hWnd);

  <span style="color:#75715e">// メッセージループ
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">while</span> (TRUE) {
    <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> GetMessage(<span style="color:#f92672">&amp;</span>msg, NULL, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
    <span style="color:#66d9ef">if</span> (i <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> i <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) {
      <span style="color:#66d9ef">break</span>;
    }
    TranslateMessage(<span style="color:#f92672">&amp;</span>msg);
    DispatchMessage(<span style="color:#f92672">&amp;</span>msg);
  }

  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
}

<span style="color:#75715e">// ウィンドウプロシージャ
</span><span style="color:#75715e"></span>LRESULT CALLBACK <span style="color:#a6e22e">WindowProc</span>(HWND hWnd, UINT msg, WPARAM wp, LPARAM lp) {
  <span style="color:#66d9ef">static</span> HMENU hMenu;  <span style="color:#75715e">// メニューハンドル
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">switch</span> (msg) {
    <span style="color:#66d9ef">case</span> WM_CREATE:
      hMenu <span style="color:#f92672">=</span> LoadMenu(NULL, <span style="color:#e6db74">&#34;IDR_MENU&#34;</span>);
      SetMenu(hWnd, hMenu);
      <span style="color:#66d9ef">break</span>;
    <span style="color:#66d9ef">case</span> WM_COMMAND:
      <span style="color:#66d9ef">switch</span> (LOWORD(wp)) {
        <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">40001</span><span style="color:#f92672">:</span>
          DestroyWindow(hWnd);
          <span style="color:#66d9ef">break</span>;
        <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">40002</span><span style="color:#f92672">:</span>
          MessageBox(NULL, <span style="color:#e6db74">&#34;Version 1.00&#34;</span>, <span style="color:#e6db74">&#34;バージョン情報&#34;</span>, MB_OK);
          <span style="color:#66d9ef">break</span>;
      }
      <span style="color:#66d9ef">break</span>;
    <span style="color:#66d9ef">case</span> WM_CLOSE:
      SetMenu(hWnd, NULL);
      DestroyMenu(hMenu);
      hMenu <span style="color:#f92672">=</span> NULL;
      <span style="color:#66d9ef">break</span>;
    <span style="color:#66d9ef">case</span> WM_DESTROY:
      PostQuitMessage(<span style="color:#ae81ff">0</span>);
      <span style="color:#66d9ef">break</span>;
    <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
      <span style="color:#66d9ef">break</span>;
  }
  <span style="color:#66d9ef">return</span> DefWindowProc(hWnd, msg, wp, lp);
}</code></pre></div></div>
</figure>
<p>以下のコードを記述したリソースファイルresource.rcを作成します。メニューやダイアログなどのリソースデータはリソースファイルに記述します。</p>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">resource.rc</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">IDR_MENU MENU {
  POPUP &#34;ファイル(&amp;F)&#34; {
    MENUITEM &#34;終了(&amp;X)&#34;, 40001
    MENUITEM &#34;バージョン情報(&amp;A)&#34;, 40002
  }
}</code></pre></div></div>
</figure>
<p>今まではソースファイルから直接実行ファイルを作成していましたが今回はリソースファイルが追加されたので次のようにします。リソースファイルのコンパイルにはリソースコンパイラwindresを使用します。</p>
<ol>
<li>コマンドgccを入力してwindow.cをコンパイルしwindow.oを生成</li>
<li>コマンドwindresを入力してresource.rcをコンパイルしresource.oを生成</li>
<li>コマンドgccを入力してwindow.oとresource.oをリンクしwindow.exeを生成</li>
</ol>
<figure class="center"><img src="programming01.png"/>
</figure>

<p>ソースファイルが複数ある場合はオブジェクトファイル(*.o)という中間ファイルを介して実行ファイルを作成します。-cオプションを指定するとオブジェクトファイルが生成されます。コマンドgccには他にも様々なオプションを指定することができます。詳細については<a href="http://x68000.q-e-d.net/~68user/unix/pickup?gcc">gccコマンドの使い方: UNIX/Linuxの部屋</a>を参照してください。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># gcc -c window.c -fexec-charset=cp932
# windres -c 65001 resource.rc resource.o
# gcc window.o resource.o -o window.exe
# ./window.exe</code></pre></div></div>
</figure>
<p>メニューつきのウィンドウが表示されたら成功です。</p>
<h3 id="ソースファイルの分割">ソースファイルの分割</h3>
<p>ソースコードは処理内容に応じて複数のファイルに記述するのが一般的です。ソースファイルを分割する際に注意すべきことはグローバルな変数・関数の<em>リンケージ</em>です。リンケージには内部リンケージと外部リンケージがあります。</p>
<p>グローバルな変数・関数に<em>static</em>という修飾子をつければ内部リンケージになり何もつけなければ外部リンケージになります。ただしC++ではグローバルな定数(const)に何もつけなければ内部リンケージになるので注意してください。</p>
<p>内部リンケージの変数・関数はそれらが定義されたファイルからしか参照することができません。</p>
<p>外部リンケージの変数・関数はどのファイルからも参照することができます。外部リンケージの変数を参照するには参照元のファイルに<em>extern</em>という修飾子をつけて参照先の変数を宣言する必要があります。外部リンケージの関数を参照するには参照元のファイルに参照先の関数のプロトタイプ宣言が必要です。当然ですが外部リンケージの変数・関数の定義が複数のソースファイルで重複することは許されません。また内部リンケージと外部リンケージの識別子が重複することも許されません。</p>
<figure class="center"><img src="programming02.png"/>
</figure>

<h3 id="ビルド作業の自動化">ビルド作業の自動化</h3>
<p>上のようにコマンドを入力して実行ファイルを作成する作業を<em>ビルド</em>といいます。詳細については<a href="https://rinatz.github.io/cpp-book/ch11-01-build/">ゼロから学ぶC++</a>を参照してください。</p>
<p>コマンドmakeを使用すればビルドを自動化することができます。以下の内容を記述したMakefile(もしくはmakefile)というファイルを作成してください。インデントにはタブを使用します。スペースでインデントするとエラーになるので注意してください。</p>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">Makefile</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Base Makefile" data-lang="Base Makefile">TARGET <span style="color:#f92672">=</span> window.exe <span style="color:#75715e"># 生成される実行ファイル</span>
SRCS <span style="color:#f92672">=</span> window.c <span style="color:#75715e"># コンパイルするソースファイル</span>
OBJS <span style="color:#f92672">=</span> <span style="color:#66d9ef">$(</span>SRCS:.c<span style="color:#f92672">=</span>.o<span style="color:#66d9ef">)</span> resource.o <span style="color:#75715e"># コンパイルするオブジェクトファイル</span>
CC <span style="color:#f92672">=</span> gcc <span style="color:#75715e"># 使用するコンパイラ</span>
CFLAGS <span style="color:#f92672">=</span> -fexec-charset<span style="color:#f92672">=</span>cp932 <span style="color:#75715e"># コンパイラのオプション</span>

<span style="color:#a6e22e">.PHONY</span><span style="color:#f92672">:</span> all clean

<span style="color:#a6e22e">all</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">$(</span>TARGET<span style="color:#66d9ef">)</span>

<span style="color:#75715e"># オブジェクトファイルから実行ファイルを作成
</span><span style="color:#75715e"></span><span style="color:#a6e22e">$(TARGET)</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">$(</span>OBJS<span style="color:#66d9ef">)</span>
	<span style="color:#66d9ef">$(</span>CC<span style="color:#66d9ef">)</span> -o $@ <span style="color:#66d9ef">$(</span>OBJS<span style="color:#66d9ef">)</span>

<span style="color:#75715e"># ソースファイルからオブジェクトファイルを作成
</span><span style="color:#75715e"></span><span style="color:#a6e22e">%.o</span><span style="color:#f92672">:</span> %.c
	<span style="color:#66d9ef">$(</span>CC<span style="color:#66d9ef">)</span> -o $@ -c <span style="color:#66d9ef">$(</span>CFLAGS<span style="color:#66d9ef">)</span> $&lt;

<span style="color:#75715e"># リソースファイルからオブジェクトファイルを作成
</span><span style="color:#75715e"></span><span style="color:#a6e22e">%.o</span><span style="color:#f92672">:</span> %.rc
	windres -c <span style="color:#ae81ff">65001</span> -i $&lt; -o $@

<span style="color:#75715e"># オブジェクトファイルを削除
</span><span style="color:#75715e"></span><span style="color:#a6e22e">clean</span><span style="color:#f92672">:</span>
	-@rm -f <span style="color:#66d9ef">$(</span>OBJS<span style="color:#66d9ef">)</span>
</code></pre></div></div>
</figure>
<p>コマンドmakeを入力するとMakefileの内容に従って実行ファイルwindow.exeが作成されます。make
cleanと入力すればオブジェクトファイルが削除されます。詳細については <a href="http://objectclub.jp/community/memorial/homepage3.nifty.com/masarl/article/gnu-make/rule.html">自動化のためのGNU Make入門講座</a>/<a href="http://x68000.q-e-d.net/~68user/unix/pickup?make">コマンド:make: UNIX/Linuxの部屋</a>/<a href="https://www.ibm.com/docs/ja/aix/7.2?topic=m-make-command">make コマンド - IBM Documentation</a>/<a href="https://www.ecoop.net/coop/translated/GNUMake3.77/make_toc.jp.html">GNU make 日本語訳</a>などを参照してください。</p>
<h3 id="メインウィンドウの表示その3">メインウィンドウの表示(その3)</h3>
<p>wxWidgetsを使用してウィンドウを表示してみます。</p>
<p>MSYS2でwxWidgetsをインストールします。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># pacman -S mingw-w64-i686-wxmsw3.1
# pacman -S mingw-w64-x86_64-wxmsw3.1</code></pre></div></div>
</figure>
<p>以下のコードを記述したソースファイルwindow.cppを作成します。</p>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">window.cpp</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C++" data-lang="C++"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;wx/wx.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// アプリケーションの単一クラス
</span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyApp</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> wxApp {
 <span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
  <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">bool</span> OnInit();
};

<span style="color:#75715e">// メインウィンドウのフレームクラス
</span><span style="color:#75715e"></span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyFrame</span> <span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> wxFrame {
 <span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
  MyFrame(<span style="color:#66d9ef">const</span> wxString<span style="color:#f92672">&amp;</span> title, <span style="color:#66d9ef">const</span> wxPoint<span style="color:#f92672">&amp;</span> pos, <span style="color:#66d9ef">const</span> wxSize<span style="color:#f92672">&amp;</span> size);

 <span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
  <span style="color:#66d9ef">void</span> OnExit(wxCommandEvent<span style="color:#f92672">&amp;</span> event);
  <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">OnAbout</span>(wxCommandEvent<span style="color:#f92672">&amp;</span> event);
};

<span style="color:#75715e">// アプリケーションを初期化
</span><span style="color:#75715e"></span><span style="color:#66d9ef">bool</span> MyApp<span style="color:#f92672">::</span>OnInit() {
  MyFrame<span style="color:#f92672">*</span> pFrame <span style="color:#f92672">=</span>
      <span style="color:#66d9ef">new</span> MyFrame(_(<span style="color:#e6db74">&#34;サンプルウィンドウ&#34;</span>), wxDefaultPosition, wxSize(<span style="color:#ae81ff">640</span>, <span style="color:#ae81ff">480</span>));
  pFrame<span style="color:#f92672">-&gt;</span>Show(true);
  <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>SetTopWindow(pFrame);
  <span style="color:#66d9ef">return</span> true;
}

<span style="color:#75715e">// メインウィンドウを初期化
</span><span style="color:#75715e"></span>MyFrame<span style="color:#f92672">::</span>MyFrame(<span style="color:#66d9ef">const</span> wxString<span style="color:#f92672">&amp;</span> title, <span style="color:#66d9ef">const</span> wxPoint<span style="color:#f92672">&amp;</span> pos, <span style="color:#66d9ef">const</span> wxSize<span style="color:#f92672">&amp;</span> size)
    <span style="color:#f92672">:</span> wxFrame(NULL, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, title, pos, size) {
  wxMenu<span style="color:#f92672">*</span> pMenu <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> wxMenu;
  pMenu<span style="color:#f92672">-&gt;</span>Append(wxID_ABOUT, _(<span style="color:#e6db74">&#34;バージョン情報(&amp;A)&#34;</span>));
  pMenu<span style="color:#f92672">-&gt;</span>Append(wxID_EXIT, _(<span style="color:#e6db74">&#34;終了(&amp;X)&#34;</span>));

  wxMenuBar<span style="color:#f92672">*</span> pMenuBar <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> wxMenuBar;
  pMenuBar<span style="color:#f92672">-&gt;</span>Append(pMenu, _(<span style="color:#e6db74">&#34;ファイル(&amp;F)&#34;</span>));
  SetMenuBar(pMenuBar);

  <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>CreateStatusBar();
  Center();
  
  <span style="color:#75715e">// イベントとハンドラを結合
</span><span style="color:#75715e"></span>  Bind(wxEVT_MENU, <span style="color:#f92672">&amp;</span>MyFrame<span style="color:#f92672">::</span>OnAbout, <span style="color:#66d9ef">this</span>, wxID_ABOUT);
  Bind(wxEVT_MENU, <span style="color:#f92672">&amp;</span>MyFrame<span style="color:#f92672">::</span>OnExit, <span style="color:#66d9ef">this</span>, wxID_EXIT);
}

<span style="color:#75715e">// OnExitハンドラ
</span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> MyFrame<span style="color:#f92672">::</span>OnExit(wxCommandEvent<span style="color:#f92672">&amp;</span> WXUNUSED(event)) { Close(true); }

<span style="color:#75715e">// OnAboutハンドラ
</span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> MyFrame<span style="color:#f92672">::</span>OnAbout(wxCommandEvent<span style="color:#f92672">&amp;</span> WXUNUSED(event)) {
  wxMessageBox(_(<span style="color:#e6db74">&#34;Version 1.00&#34;</span>), _(<span style="color:#e6db74">&#34;バージョン情報&#34;</span>),
               wxOK <span style="color:#f92672">|</span> wxICON_INFORMATION, <span style="color:#66d9ef">this</span>);
}

IMPLEMENT_APP(MyApp)</code></pre></div></div>
</figure>
<p>コマンドg++を入力してwindow.cppをコンパイルします。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># g++ window.cpp -o window -fexec-charset=cp932 `wx-config-3.1 --cxxflags --libs`
# ./window.exe</code></pre></div></div>
</figure>
<p>ウィンドウが表示されたら成功です。WindowsAPIを使用した場合と比較してソースコードがかなり短くなりました。</p>
<p>wxWidgetsはC++で使用できるGUIツールキット(C++のクラスライブラリ)です。wxWidgetsには便利で高機能なクラスがたくさん用意されています。<a href="https://github.com/wxFormBuilder/wxFormBuilder">wxFormBuilder</a>などのGUIビルダと併用すれば効率的にGUIのアプリケーションを作成することができます。詳細については<a href="https://murank.github.io/wxwidgetsjp/">wxWidgets 日本語ドキュメントプロジェクト</a>を参照してください。</p>
<h2 id="プログラミングの学習方法">プログラミングの学習方法</h2>
<p>MSYS2はプログラミングの学習に最適な環境です。MSYS2でサンプルコードを繰り返し実行する方法を紹介します。</p>
<p>a.exeを簡単に実行できるようにするためあらかじめ以下のようなエイリアスを設定しておきます。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Bash" data-lang="Bash">alias foo<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;$HOME/a.exe&#39;</span></code></pre></div></div>
</figure>
<p>以下のようにコマンドcatを入力してコピーしたサンプルコードを貼り付けCtrl-dを入力します。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># cat &gt;foo.c</code></pre></div></div>
</figure>
<p>コマンドgccを入力してサンプルコードをコンパイルし実行します。</p>


<figure class="xCodeBlock">

<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># gcc foo.c
# foo</code></pre></div></div>
</figure>
<p>プログラミングは習うより慣れろです。見よう見まねでやっていけば自然に身につきます。覚えることはたくさんありますが単純なことを1つ1つ積み重ねていくだけです。そして理屈よりも実際にプログラムを動かしてプログラミングに親しむことが大切です。</p>
<!--
C/C++およびWindowsAPIについて解説しているウェブサイトを紹介しておきます。

| | |
|-|-|
| [WisdomSoft](http://wisdom.sakura.ne.jp/) | C/C++およびWindowsAPIについての解説があります。ポイントを押さえた説明のあとに単純なプログラムで実際の動作を示しています。プログラミングが初めての人でも途中でつまづくことはないでしょう。 |
| [Programming Place Plus](https://programming-place.net/ppp/index.html) | C/C++の構文や仕様についての詳細を分かりやすく説明しています。各章の終わりには演習問題が用意されています。C/C++のリファレンスとしても重宝します。 |
| [KAB-studio](http://www.kab-studio.biz/) | VC(Microsoftの統合開発環境)とMFC(VCに付属するクラスライブラリ)によるWindowsプログラミングについて解説しています。内容は少し古いですがC++についての解説は参考になります。 |
| [ロベールのＣ＋＋教室](http://www7b.biglobe.ne.jp/~robe/cpphtml/index.html) | C++についてC言語を知らない人にも分かるように基礎から解説しています。各章の要点が最初と最後に掲げられ解説も短くまとまっているので読み進めやすいですが、取り上げる内容が広範囲におよぶため、ある程度コンピュータやプログラミングについての知識がないと消化不良を起こすかもしれません。中級者以上の人がC++およびプログラミングについての知識を整理するのには役に立つでしょう。 |
| [猫でもわかるプログラミング](http://www.kumei.ne.jp/c_lang/) | C/C++およびWindowsAPIについて解説しています。猫でもわかると銘打たれていますがそれに反して内容はかなり実践的です。章を追うごとにサンプルプログラムが長くなるのでプログラミングの経験がないと挫折するかもしれません。 |
-->
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>独自の変数型や構造体がたくさん出てきますが難しく考える必要はありません。&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>MSYS2 MinGW 64-bitの環境で作成したプログラムは32bitの環境では動作しないので注意してください。&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p>プログラムのコーディングには<a href="https://code.visualstudio.com/">Visual Studio Code</a>を使用する人が多いようです。&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4" role="doc-endnote">
<p>ウィンドウクラスはC++のクラスとは関係ありません。混同しないように注意してください。&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5" role="doc-endnote">
<p>イベントについての情報はパラメータとしてウィンドウプロシージャに渡されます。&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>


    </div><footer>
<span>Powered by <a href="https://gohugo.io/">Hugo</a></span>
<iframe src="https://rcm-fe.amazon-adsystem.com/e/cm?o=9&p=13&l=ez&f=ifr&linkID=fd3be03ff2b0d855a5bee93947c62cb5&t=foo23-22&tracking_id=foo23-22" width="468" height="60" scrolling="no" border="0" marginwidth="0" style="border:none;" frameborder="0"></iframe>
</footer>

</body>
</html>
