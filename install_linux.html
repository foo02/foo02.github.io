<!DOCTYPE html>
<html><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Linuxのインストール</title>
<link rel="stylesheet" href="https://foo02.github.io/normalize.css" />
<link rel="stylesheet" href="https://foo02.github.io/style.css" />
<link rel="icon" href="/favicon.png" />
</head><body><header>
<script type="text/javascript" src="//xa.shinobi.jp/ufo/190668700"></script><noscript><a href="//xa.shinobi.jp/bin/gg?190668700" target="_blank"><img src="//xa.shinobi.jp/bin/ll?190668700" border="0"></a><br><span style="font-size:9px"><img style="margin:0;vertical-align:text-bottom;" src="//img.shinobi.jp/tadaima/fj.gif" width="19" height="11"> </span></noscript>
<div id="date"></div>
<div><a href="https://foo02.github.io/">トップページ</a></div>
<h1>Linuxのインストール</h1>
<nav id="TableOfContents">
  <ul>
    <li><a href="#はじめに">はじめに</a></li>
    <li><a href="#biosmbrとuefigpt">BIOS/MBRとUEFI/GPT</a></li>
    <li><a href="#デバイスマッパーとlukslvm">デバイスマッパーとLUKS/LVM</a></li>
    <li><a href="#arch-linuxのインストール">Arch Linuxのインストール</a></li>
  </ul>
</nav>
</header><div id="content">
<h2 id="はじめに">はじめに</h2>
<p><a href="https://ja.wikipedia.org/wiki/Arch_Linux">Arch Linux</a>を<a href="https://ja.wikipedia.org/wiki/VirtualBox">VirtualBox</a>にインストールします。インストールするパッケージについては<a href="https://wiki.archlinux.jp/index.php/%E3%83%A1%E3%82%A4%E3%83%B3%E3%83%9A%E3%83%BC%E3%82%B8">ArchWiki</a>を参照してください。VirtualBoxについては<a href="https://vboxmania.net/">VirtualBox Mania</a>を参照してください。</p>
<h2 id="biosmbrとuefigpt">BIOS/MBRとUEFI/GPT</h2>
<p>Linuxをインストールするにあたって<em>BIOS/MBR</em>と<em>UEFI/GPT</em>の違いを理解しておく必要があります。両者は機能的には同じものでUEFI/GPTはBIOS/MBRの後継として開発されました。</p>
<p>BIOSおよびUEFIにはWindowsなどのOSとハードウェアの橋渡しをする役目があります。これらはPCにあらかじめ内蔵されたプログラムであり、電源投入時にハードウェアを初期化したりOSを起動したりします。</p>
<p>MBRおよびGPTはハードディスクなどのブロックデバイスの先頭にある小さな領域です。ここにはパーティション<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>の構成情報がパーティションテーブルとして格納されています。</p>
<p>OSをインストールすることができるパーティションをプライマリパーティションといいます。MBRでは4つのプライマリパーティションしか作成できませんが<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>GPTでは128のプライマリパーティションを作成することができます。</p>
<p>OSを起動するためのプログラムをブートローダといいます。ブートローダは電源投入時にBIOSもしくはUEFIによって実行されます。BIOSではMBRと特定のパーティションにブートローダが格納されています。UEFIではESPという専用のパーティションにブートローダが格納されています。</p>
<figure class="center"><img src="bios_uefi.png"/>
</figure>

<h2 id="デバイスマッパーとlukslvm">デバイスマッパーとLUKS/LVM</h2>
<p>Linuxにはデバイスマッパーと呼ばれるブロックデバイスの仮想レイヤーがあります。これは物理デバイスを抽象化して扱いやすくします。LUKS/LVMはこのデバイスマッパーを利用しています。LUKSはブロックデバイスを暗号化する仕組みです。LVMは複数の物理ブロックデバイスを仮想的な1つのブロックデバイスとして扱う仕組みです。</p>
<p>LVMにはPV/VG/LVという3つの構成要素があります。PVは物理ブロックデバイスです。VGはPVで構成された仮想的な1つのブロックデバイスです。LVはVGに作成された仮想的なパーティションです。この仕組みによって物理ブロックデバイスの構成を気にすることなくパーティションを操作することができます。</p>
<figure class="center"><img src="lvm.png"/>
</figure>

<h2 id="arch-linuxのインストール">Arch Linuxのインストール</h2>
<p>ここではVirtualBoxを使用してUEFIの仮想PCにArch Linuxをインストールします。<a href="https://www.archlinux.jp/download/">Arch Linuxのイメージファイル</a>(archlinux-*-x86_64.iso)をダウンロードしておいてください。</p>
<p>VirtualBoxでインストール用に作成した仮想PCを以下のように設定します。</p>
<ol>
<li>VirtualBoxマネージャーのリストから仮想PCを選択して<em>設定</em>をクリックします。</li>
<li>左のリストから<em>システム</em>を選択して<em>EFIを有効化</em>をチェックします。</li>
<li>左のリストから<em>ストレージ</em>を選択して<em>ストレージデバイス</em>のリストから<em>空</em>と表示されたCDのアイコンをクリックします。</li>
<li>右上にあるCDのアイコンをクリックしてメニューから<em>ディスクファイルを選択</em>を選択します。</li>
<li>表示されたファイル選択ダイアログでArch Linuxのイメージファイルを選択して<em>開く</em>をクリックします。</li>
<li>左のリストから<em>ネットワーク</em>を選択して<em>アダプター1</em>の<em>ネットワークアダプターを有効化</em>がチェックされ<em>割り当て</em>が<em>NAT</em>になっていることを確認します。</li>
<li><em>高度</em>をクリックして<em>ポートフォワーディング</em>をクリックします。</li>
<li>一番右上のアイコンをクリックしてルールを追加し、ホストポートに1024、ゲストポートに22を指定して<em>OK</em>をクリックします。</li>
<li><em>OK</em>をクリックします。</li>
</ol>
<p>インストール先のハードディスク(sda)のレイアウトを決めておきます。最初のパーティション(sda1)をESPにします。次のパーティション(sda2)をルートパーティションにします。sda2は<a href="https://wiki.archlinux.jp/index.php/Dm-crypt">LUKS</a>で暗号化して、その上に<a href="https://wiki.archlinux.jp/index.php/LVM">LVM</a>を構築します。</p>
<figure class="center"><img src="lvm_on_luks.png"/>
</figure>

<p>仮想PCを起動してしばらくすると一時的なUnix環境が構築され自動的にrootユーザにログインします。Arch Linuxにはインストーラが用意されていません。シェルを使用してインストール作業を進めていきます。</p>
<p>キーボードレイアウトを日本語に設定します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># loadkeys jp106</code></pre></div>
<p><a href="http://x68000.q-e-d.net/~68user/unix/pickup?ssh">ssh</a>で使用するためのパスワードを設定します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># passwd</code></pre></div>
<p>MSYS2のターミナルでsshを実行してホストOSからゲストOSに接続します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">$ ssh -p 1024 root@localhost</code></pre></div>
<p>設定したパスワードを入力すれば接続できます。接続に失敗した場合は以下のようにして再度接続します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">$ ssh-keygen -R &#39;[localhost]:1024&#39;</code></pre></div>
<p>以後はMSYS2のターミナルで作業することができます。</p>
<p>UEFIモードで起動していることを確認します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># ls /sys/firmware/efi/efivars</code></pre></div>
<p>ネットワークインターフェイスが認識され有効であることを確認します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># ip link</code></pre></div>
<p>ここでは使用しませんが<a href="https://wiki.archlinux.jp/index.php/%E3%83%AF%E3%82%A4%E3%83%A4%E3%83%AC%E3%82%B9%E8%A8%AD%E5%AE%9A">Wi-Fi</a>に接続する方法を記載しておきます。ネットワークインターフェイスをwlan0としています。最初にインターフェイス名とアクセスポイントとの接続状態を確認します。次にインターフェイスを初期化してアクセスポイント(SSID)と暗号化キー(PASSPHRASE)をインターフェイスに関連付けます。最後にインターフェイスにIPアドレスを割り当てます。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># iw dev
# iw dev wlan0 link
# ip link set wlan0 up
# wpa_supplicant -B -i wlan0 -c &lt;(wpa_passphrase SSID PASSPHRASE)
# dhcpcd wlan0</code></pre></div>
<p>インターネットに接続できていることを確認します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># ping -c3 archlinux.jp</code></pre></div>
<p>システムクロックを合わせて状態を確認します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># timedatectl set-ntp true
# timedatectl status</code></pre></div>
<p>ハードディスクがsdaとして認識されていることを確認します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># lsblk</code></pre></div>
<p>/dev/sdaに<a href="https://wiki.archlinux.jp/index.php/%E3%83%91%E3%83%BC%E3%83%86%E3%82%A3%E3%82%B7%E3%83%A7%E3%83%8B%E3%83%B3%E3%82%B0">パーティション</a>を作成して正しくパーティショニングされていることを確認します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># parted /dev/sda
(parted) mklabel gpt
(parted) mkpart ESP fat32 1MiB 551MiB
(parted) set 1 esp on
(parted) mkpart primary ext4 551MiB 100%
(parted) print
(parted) quit</code></pre></div>
<p>sda2をcrypt-rootというデバイス名で暗号化します。暗号化したデバイスやパーティションを使用するにはパスワードを入力して解錠する必要があります。解錠すると指定したデバイス名で/dev/mapperに追加され、暗号化したデバイスやパーティションを使用できるようになります。/dev/sda2を解錠すると/dev/mapper/crypt-rootとして追加されます。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># cryptsetup luksFormat /dev/sda2
# cryptsetup luksDump /dev/sda2
# cryptsetup open /dev/sda2 crypt-root</code></pre></div>
<p>crypt-root(暗号化したsda2)をPV(物理ブロックデバイス)として登録します。このPVをvgというグループ名のVG(仮想的なブロックデバイス)に追加します。そしてvg全体を使用してrootというボリューム名の1つのLV(仮想的なパーティション)を作成します。作成したLVは&quot;(VG名)-(LV名)&ldquo;というデバイス名で/dev/mapperに追加されます。/dev/mapper/crypt-rootにLVMが構築され、作成したLVが/dev/mapper/vg-rootとして使用できるようになります。このようにLUKSの上にLVMを構築した場合、デバイスをまたいでLVMを使用することができなくなるので注意してください。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># pvcreate /dev/mapper/crypt-root
# vgcreate vg /dev/mapper/crypt-root
# lvcreate -l 100%FREE vg -n root</code></pre></div>
<p>パーティションをフォーマットして/mntにルートパーティションをマウントします。ESPは/mnt/bootにマウントします。マウントする順番を間違えないように注意してください。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># mkfs.vfat -F32 /dev/sda1
# mkfs.ext4 /dev/mapper/vg-root
# mount /dev/mapper/vg-root /mnt
# mkdir /mnt/boot
# mount /dev/sda1 /mnt/boot</code></pre></div>
<p>パッケージは/etc/pacman.d/mirrorlistにリストされている<a href="https://wiki.archlinux.jp/index.php/%E3%83%9F%E3%83%A9%E3%83%BC">ミラーサーバ</a>からダウンロードされます。このリストに日本のサーバを追加しておきます。サーバはリストの上位にあるものが優先的に使用されます。</p>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">/etc/pacman.d/mirrorlist</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">##
## Arch Linux repository mirrorlist
## Filtered by mirror score from mirror status page
## Generated on ****-**-**
##

Server = http://ftp.jaist.ac.jp/pub/Linux/ArchLinux/$repo/os/$arch
Server = http://ftp.tsukuba.wide.ad.jp/Linux/archlinux/$repo/os/$arch</code></pre></div></div>
</figure>
<p>ミラーサーバを変更したらパッケージのデータベースを更新します。このデータベースが最新の状態でなければパッケージのダウンロードに失敗するので注意してください。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># pacman -Syyu</code></pre></div>
<p>システムの起動に必要な最小限のパッケージをインストールします。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># pacstrap /mnt linux base</code></pre></div>
<p><a href="https://wiki.archlinux.jp/index.php/Fstab">fstab</a>を作成して正しく書き出されていることを確認します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># genfstab -U /mnt &gt;&gt;/mnt/etc/fstab
# cat /mnt/etc/fstab</code></pre></div>
<p>インストールするシステムに<a href="https://wiki.archlinux.jp/index.php/Chroot">chroot</a>します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># arch-chroot /mnt</code></pre></div>
<p>タイムゾーンを設定します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># ln -fs /usr/share/zoneinfo/Asia/Tokyo /etc/localtime
# hwclock --systohc --utc</code></pre></div>
<p>ロカールを設定します。/etc/locale.genをエディタで開いてen_US.UTF-8およびja_JP.UTF-8のコメントを解除してください。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># pacman -S vim
# vim /etc/locale.gen
# locale-gen
# echo LANG=en_US.UTF-8 &gt;/etc/locale.conf</code></pre></div>
<p>コンソールのキーボードレイアウトおよび<a href="https://wiki.archlinux.jp/index.php/%E3%83%95%E3%82%A9%E3%83%B3%E3%83%88#.E3.82.B3.E3.83.B3.E3.82.BD.E3.83.BC.E3.83.AB.E3.83.95.E3.82.A9.E3.83.B3.E3.83.88">フォント</a>を設定します。デフォルトのフォントは小さいので大きめのフォントを指定しています。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># pacman -S terminus-font
# vim /etc/vconsole.conf</code></pre></div>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">/etc/vconsole.conf</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">KEYMAP=jp106
FONT=ter-v28b</code></pre></div></div>
</figure>
<p>ホスト名を追加します。以下のHOSTNAMEは自分のホスト名に置き換えてください。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># echo HOSTNAME &gt;/etc/hostname
# vim /etc/hosts</code></pre></div>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">/etc/hosts</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># Static table lookup for hostnames.
# See hosts(5) for details.
127.0.0.1       localhost
::1             localhost
127.0.1.1       HOSTNAME.localdomain HOSTNAME</code></pre></div></div>
</figure>
<p><a href="https://wiki.archlinux.jp/index.php/Dhcpcd">DHCP</a>の設定を有効にします。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># pacman -S dhcpcd
# systemctl enable dhcpcd</code></pre></div>
<p><a href="https://wiki.archlinux.jp/index.php/Mkinitcpio#HOOKS">フック</a>を設定します。/etc/mkinitcpio.confをエディタで開いて以下に示す箇所を書き換えます。項目の順番を間違えないように注意してください。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># vim /etc/mkinitcpio.conf</code></pre></div>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">/etc/mkinitcpio.conf</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">HOOKS=(... keyboard keymap block encrypt lvm2 ... filesystems ...)</code></pre></div></div>
</figure>
<p>LVMをインストールして初期RAMディスク(<a href="https://ja.wikipedia.org/wiki/Initrd">initramfs</a>)を生成します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># pacman -S lvm2
# mkinitcpio -p linux</code></pre></div>
<p>rootユーザのパスワードを設定します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># passwd</code></pre></div>
<p>ブートマネージャ(<a href="https://wiki.archlinux.jp/index.php/GRUB">GRUB</a>)をインストールします。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># pacman -S grub efibootmgr
# grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=grub
# grub-mkconfig -o /boot/grub/grub.cfg
# mkdir /boot/EFI/boot
# cp /boot/EFI/grub/grubx64.efi /boot/EFI/boot/bootx64.efi</code></pre></div>
<p>/dev/sda2の<a href="https://wiki.archlinux.jp/index.php/%E6%B0%B8%E7%B6%9A%E7%9A%84%E3%81%AA%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%83%87%E3%83%90%E3%82%A4%E3%82%B9%E3%81%AE%E5%91%BD%E5%90%8D#by-uuid">UUID</a>を確認してから/etc/default/grubをエディタで開きます。起動時に暗号化した/dev/sda2を解錠できるようにするためにカーネルのパラメータを設定します。デバイス名にはUUIDを指定してください。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># lsblk -f
# vim /etc/default/grub</code></pre></div>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">/etc/default/grub</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">GRUB_CMDLINE_LINUX=&#34;cryptdevice=UUID=81e69136-b1c6-46c7-8141-8e76554b2a2c:crypt-root root=/dev/mapper/vg-root&#34;</code></pre></div></div>
</figure>
<p>GRUBの設定を変更したらgrub-mkconfigを実行して設定を更新する必要があります。忘れやすいので注意してください。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># grub-mkconfig -o /boot/grub/grub.cfg</code></pre></div>
<p>chrootから抜けて/mntにマウントしたパーティションをアンマウントします。最後に仮想PCをシャットダウンします。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># exit
# umount -R /mnt
# shutdown -h now</code></pre></div>
<p>仮想PCからArch Linuxのインストールディスクを取り出します。</p>
<ol>
<li>VirtualBoxマネージャーのリストから仮想PCを選択して<em>設定</em>をクリックします。</li>
<li>左のリストから<em>ストレージ</em>を選択して右上にあるCDのアイコンをクリックしメニューから<em>仮想ドライブからディスクを除去</em>を選択します。</li>
<li><em>OK</em>をクリックします。</li>
</ol>
<p>以上でインストール作業は終了です。Arch Linuxが正常に起動することを確認してください。起動直後にLUKSで設定したパスワードを要求されます。パスワードが正しければルートパーティションが解錠されてシステムが起動します。</p>
<p>スワップファイルを作成します。スワップファイルはメモリが足りなくなったときに使用されます。メモリサイズに余裕があるのであれば必要ありません。再起動後に有効になっていることを確認します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># fallocate -l 512M /swapfile
# chmod 600 /swapfile
# mkswap /swapfile
# swapon /swapfile
# echo /swapfile none swap defaults 0 0 &gt;&gt;/etc/fstab
# reboot
# free -h</code></pre></div>
<p>VirtualBoxのGuest Additionsをインストールします。メニューの<em>デバイス</em>から<em>Guest Additions CDイメージの挿入</em>を選択してください。マウントする前にCDドライブがsr0として認識されていることを確認します。マウントしたらCDの内容を確認してVBoxLinuxAdditions.runというスクリプトを実行します。再起動後に有効になっていることを確認します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># pacman -S linux-headers base-devel
# lsblk
# mkdir /mnt/cdrom
# mount /dev/sr0 /mnt/cdrom
# ls /mnt/cdrom
# sh /mnt/cdrom/VBoxLinuxAdditions.run
# reboot
# systemctl status vboxadd-service</code></pre></div>
<p>一般ユーザを作成します。以下のUSERNAMEは自分のユーザ名に置き換えてください。visudoで&rdquo;%wheel ALL=(ALL) ALL&quot;のコメントを解除してください。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># useradd -m -G wheel -s /bin/bash USERNAME
# passwd USERNAME
# EDITOR=vim visudo</code></pre></div>
<p>rootユーザからログアウトしてUSERNAMEでログインします。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># exit</code></pre></div>
<p>pacmanのカラー出力を有効にします。/etc/pacman.confをエディタで開いてColorのコメントを解除してください。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">$ sudo vim /etc/pacman.conf</code></pre></div>
<p>使用されているグラフィックカードを確認した後、ビデオドライバおよび<a href="https://wiki.archlinux.jp/index.php/Xorg">X</a>をインストールします。次にXのキーボードレイアウトを日本語に設定します。最後にXが起動することを確認してください。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">$ lspci | grep -e VGA -e 3D
$ sudo pacman -S xf86-video-vmware xorg-server xorg-apps xorg-xinit xorg-twm xorg-xclock xterm
$ localectl set-x11-keymap jp
$ startx</code></pre></div>
<p><a href="https://wiki.archlinux.jp/index.php/%E3%83%95%E3%82%A9%E3%83%B3%E3%83%88">フォント</a>をインストールします。ここではNotoフォントをインストールしています。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">$ sudo pacman -S noto-fonts noto-fonts-cjk noto-fonts-emoji noto-fonts-extra</code></pre></div>
<p>フォントを設定します。/etc/fonts/local.confに以下の設定を記述してフォントキャッシュを更新します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">$ sudo vim /etc/fonts/local.conf</code></pre></div>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">/etc/fonts/local.conf</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">&lt;?xml version=&#34;1.0&#34;?&gt;
&lt;!DOCTYPE fontconfig SYSTEM &#34;fonts.dtd&#34;&gt;
&lt;fontconfig&gt;
  &lt;alias&gt;
    &lt;family&gt;serif&lt;/family&gt;
    &lt;prefer&gt;
      &lt;family&gt;Noto Serif&lt;/family&gt;
      &lt;family&gt;Noto Serif CJK JP&lt;/family&gt;
    &lt;/prefer&gt;
  &lt;/alias&gt;
  &lt;alias&gt;
    &lt;family&gt;sans-serif&lt;/family&gt;
    &lt;prefer&gt;
      &lt;family&gt;Noto Sans&lt;/family&gt;
      &lt;family&gt;Noto Sans CJK JP&lt;/family&gt;
    &lt;/prefer&gt;
  &lt;/alias&gt;
  &lt;alias&gt;
    &lt;family&gt;monospace&lt;/family&gt;
    &lt;prefer&gt;
      &lt;family&gt;Noto Sans Mono&lt;/family&gt;
      &lt;family&gt;Noto Sans Mono CJK JP&lt;/family&gt;
    &lt;/prefer&gt;
  &lt;/alias&gt;
&lt;/fontconfig&gt;</code></pre></div></div>
</figure>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">$ fc-cache -fv</code></pre></div>
<p>ロカールを日本語に設定します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">$ sudo vim /etc/locale.conf</code></pre></div>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">/etc/locale.conf</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">LANG=ja_JP.UTF-8
# LANG=en_US.UTF-8</code></pre></div></div>
</figure>
<p>ディスプレイマネージャ(<a href="https://wiki.archlinux.jp/index.php/LightDM">LightDM</a>)をインストールして有効にします。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">$ sudo pacman -S lightdm lightdm-gtk-greeter
$ sudo systemctl enable lightdm</code></pre></div>
<p>ネットワークマネージャ(<a href="https://wiki.archlinux.jp/index.php/NetworkManager">NetworkManager</a>)をインストールして有効にします。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">$ sudo pacman -S networkmanager
$ sudo systemctl enable NetworkManager
$ sudo systemctl start NetworkManager</code></pre></div>
<!--
ウィンドウマネージャ(Openbox)とターミナルエミュレータ(LXTerminal)をインストールします。

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">$ sudo pacman -S openbox lxterminal</code></pre></div>

Xの起動時にウィンドウマネージャとしてOpenboxが起動するようにします。

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">$ vim ~/.xinitrc</code></pre></div>



<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">~/.xinitrc</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext"># twm &amp;
# xclock -geometry 50x50-1+1 &amp;
# xterm -geometry 80x50+494+51 &amp;
# xterm -geometry 80x20+494-0 &amp;
# exec xterm -geometry 80x66+0+0 -name login
exec openbox-session</code></pre></div></div>
</figure>
-->
<p>IME(<a href="https://wiki.archlinux.jp/index.php/Fcitx5">fcitx5</a>)をインストールします。次に~/.xprofileをエディタで開いて以下の設定を記述します。最後に設定を開いて入力メソッドにMozcが追加されていることを確認します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">$ sudo pacman -S fcitx5 fcitx5-mozc fcitx5-im fcitx5-configtool
$ vim ~/.xprofile
$ fcitx5-configtool</code></pre></div>


<figure class="xCodeBlock">
<figcaption class="xCodeBlock_title">~/.xprofile</figcaption>
<div class="xCodeBlock_code"><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">export GTK_IM_MODULE=fcitx
export QT_IM_MODULE=fcitx
export XMODIFIERS=@im=fcitx
export DefaultIMModule=fcitx
fcitx-autostart</code></pre></div></div>
</figure>
<p><a href="https://wiki.archlinux.jp/index.php/Arch_User_Repository">AUR</a>のパッケージを扱えるようにするためAURヘルパー(yay)をインストールします。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">$ sudo pacman -S git
$ git clone https://aur.archlinux.org/yay.git
$ cd yay
$ makepkg -si
$ cd
$ rm -rfv yay</code></pre></div>
<p>デスクトップ環境(<a href="https://wiki.archlinux.jp/index.php/LXDE">LXDE</a>)をインストールします。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">$ sudo pacman -S lxde</code></pre></div>
<p>再起動します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plaintext" data-lang="plaintext">$ sudo reboot</code></pre></div>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>ブロックデバイスは複数の区画に分割することができます。その区画をパーティションといいます。&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>プライマリパーティションの1つを拡張パーティションに指定すればその中にいくつでもパーティションを作成することができます。ただし拡張パーティションにはOSをインストールすることができません。&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>


    </div><footer>
<span>Powered by <a href="https://gohugo.io/">Hugo</a></span>
<iframe src="https://rcm-fe.amazon-adsystem.com/e/cm?o=9&p=13&l=ez&f=ifr&linkID=fd3be03ff2b0d855a5bee93947c62cb5&t=foo23-22&tracking_id=foo23-22" width="468" height="60" scrolling="no" border="0" marginwidth="0" style="border:none;" frameborder="0"></iframe>
</footer>

</body>
</html>
